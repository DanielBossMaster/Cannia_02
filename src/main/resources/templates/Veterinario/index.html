<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veterinario</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#170022",
                        secondary: "#170022",
                        lightBg: "#F3E8FF",
                        lightSurface: "rgb(247,248,249)",
                        darkText: "#1e293b",
                        softText: "#475569",
                        borderLight: "#e2e8f0",
                    },
                },
            },
        };
    </script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }

        .tab-active {
            border-bottom: 3px solid #170022;
        }

        .tab-btn {
            transition: all 0.2s ease-in-out;
        }
    </style>
</head>

<body class="bg-lightBg text-darkText min-h-screen flex flex-col">

<!-- Header -->
<header class="bg-secondary text-white flex justify-between items-center px-6 py-3 shadow-md">
    <div class="flex items-center space-x-3">
        <img src="/img/logo.png" alt="Logo" class="w-8 h-8">
        <h1 class="text-lg font-bold">Cannia</h1>
    </div>
    <a th:href="@{/veterinario/HistoriaClinica}"><button class="text-sm hover:font-bold">Mascotas</button></a>
    <a th:href="@{/cerrar-sesion}"><button class="text-sm hover:font-bold">Cerrar sesión</button></a>
</header>

<!-- Nav Tabs -->
<nav class="bg-lightSurface  text-softText flex space-x-6 px-6 border-b border-borderLight shadow-sm">
    <button class="py-3 focus:outline-none tab-btn tab-active" data-tab="admin">Consultorio</button>
    <button class="py-3 focus:outline-none tab-btn" data-tab="inventario">Inventario</button>
    <button class="py-3 focus:outline-none tab-btn" data-tab="citas">Citas</button>
    <button class="py-3 focus:outline-none tab-btn" data-tab="historia">Ventas</button>
</nav>

<!-- Contenido -->
<main class="  flex-grow mx-auto w-3/4 px-6 py-8">
    <!-- ADMINISTRACIÓN -->
    <section id="tab-admin" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold">Gestión de Propietarios</h2>
            <div>
                <button class="bg-white p-2 shadow-2xl rounded-t-lg transform hover:scale-105 mx-8 text-center hover:shadow-xl hover:bg-gray-50 transition-all duration-30">Agregar Propietario</button>
            </div>
        </div>

        <div class="bg-lightSurface w-full p-6 shadow-md border border-borderLight w overflow-x-auto ">
            <table class="w-full text-left text-sm">
                <thead class="bg-gray-100 text-softText  uppercase text-xs">
                <tr>
                    <th class="px-4 py-3">Nombre</th>
                    <th class="px-4 py-3">Correo</th>
                    <th class="px-4 py-3">Teléfono</th>
                    <th class="px-4 py-3">Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="prop : ${propietarios}"  class="border-t border-borderLight hover:bg-gray-100 transition">
                    <td th:text="${prop.nombrePro + ' ' + prop.apellidoPro}" class="px-4 py-3"></td>
                    <td th:text="${prop.correoPro}" class="px-4 py-3"></td>
                    <td th:text="${prop.telefonoPro}" class="px-4 py-3"></td>
                    <td class="px-4 py-3">
                        <div class="flex flex-col sm:flex-row items-center gap-2 justify-center sm:justify-start">
                        <a th:href="@{/veterinario/actualizar/{id}(id=${prop.id})}">
                            <button class=" rounded bg-blue-600 px-3 py-1 rounded text-sm text-white hover:bg-blue-700 transition">Editar</button>
                        </a>
                        <form method="post" th:action="@{/veterinario/borrarp/{id}(id=${prop.id})}">
                            <button onclick="return confirm('¿Desea Eliminar?')" class="bg-gray-600 px-3 py-1 rounded text-sm text-white font-bolt  hover:bg-red-700 transition">Eliminar</button>
                        </form>
                            <button
                                    type="button"
                                    class="bg-green-600 px-3 py-1 rounded text-sm text-white hover:bg-green-700 transition"
                                    th:onclick="'abrirModalMascota(' + ${prop.id} + ')'">
                                Agregar Mascota
                            </button>

                        </div>
                    </td>

                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- INVENTARIO -->
    <section id="tab-inventario" class="tab-content hidden">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold">Inventario de Productos</h2>
            <button class="bg-secondary text-white px-4 py-2 rounded-md hover:bg-purple-700 transition">+ Nuevo Producto</button>
        </div>

        <div class="bg-lightSurface rounded-lg p-6 shadow-sm border border-borderLight">
            <p class="text-softText text-sm">
                Aquí podrás registrar, editar y controlar el stock de productos veterinarios.
            </p>
        </div>
    </section>

    <!-- CITAS -->
    <section id="tab-citas" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">Gestión de Citas</h2>
        <div class="bg-lightSurface p-6 rounded-lg shadow-sm border border-borderLight">
            <p class="text-softText text-sm">
                Aquí aparecerán las citas programadas con los propietarios y sus mascotas.
            </p>
        </div>
    </section>

    <!-- HISTORIA CLÍNICA -->
    <section id="tab-historia" class="tab-content hidden">
        <h2 class="text-xl font-bold mb-4">Historia Clínica</h2>
        <div class="bg-lightSurface p-6 rounded-lg shadow-sm border border-borderLight">
            <p class="text-softText text-sm">
                Consulta y edita las historias clínicas registradas por los veterinarios.
            </p>
        </div>
    </section>

</main>

<!-- Footer -->
<footer class=" text-center text-sm text-primary py-3">
    © 2025 App Cannia. Todos los derechos reservados.
</footer>

<!-- MODAL REGISTRAR PROPIETARIO -->
<div id="modalPropietario" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-lightSurface w-full  max-w-md  shadow-lg p-6 relative">
        <h3 class="text-lg font-bold text-primary mb-4">Registrar Propietario</h3>
        <form th:action="@{/veterinario/nuevo}" method="post" th:object="${propietario}" class="space-y-4">
            <div>
                <label class="block text-sm font-semibold text-softText">Numero de Documento</label>
                <input type="text" th:field="*{numDoc}" class="w-full border border-borderLight rounded-md px-3 py-2 " required>
            </div>
            <div>
                <label class="block text-sm font-semibold text-softText">Nombre</label>
                <input type="text" th:field="*{nombrePro}" class="w-full border border-borderLight rounded-md px-3 py-2 " required>
            </div>
            <div>
                <label class="block text-sm font-semibold text-softText">Apellido</label>
                <input type="text" th:field="*{apellidoPro}" class="w-full  border-borderLight  px-3 py-2 " required>
            </div>
            <div>
                <label class="block text-sm font-semibold text-softText">Direccion</label>
                <input type="text" th:field="*{direccionPro}" class="w-full  border-borderLight  px-3 py-2 " required>
            </div>
            <div>
                <label class="block text-sm font-semibold text-softText">Teléfono</label>
                <input type="text" th:field="*{telefonoPro}"  class="w-full  border-borderLight  px-3 py-2 " required>
            </div>
            <div>
                <label class="block text-sm font-semibold text-softText">Correo</label>
                <input type="email" th:field="*{correoPro}" class="w-full  border-borderLight  px-3 py-2 " required>
            </div>
            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" onclick="toggleModal('modalPropietario')" class="bg-secondary text-white px-4 py-2 rounded-md hover:bg-lightSurface hover:shadow-xl hover:text-primary font-bold transition">Cancelar</button>
                <button type="submit" class="bg-secondary text-white px-4 py-2 rounded-md hover:bg-lightSurface hover:shadow-xl hover:text-primary font-bold transition">Guardar</button>
            </div>
        </form>
        <button onclick="toggleModal('modalPropietario')" class="absolute top-3 right-3 text-softText hover:text-primary">
            <span class="material-icons text-lg">close</span>
        </button>
    </div>
</div><!-- MODAL REGISTRAR MASCOTA -->
<div th:each="prop : ${propietarios}" >
    <div id="modalMascota" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-lightSurface w-full max-w-md  shadow-lg p-6 relative">
            <h3 class="text-lg font-bold text-primary mb-4">Registrar Mascota</h3>
            <form th:action="@{/veterinario/nuevom}" method="post" th:object="${mascota}"  class="space-y-4">

                <input type="hidden" name="propietarioId" id="propietarioId">
                <div>
                    <label class="block text-sm font-semibold text-softText">Nombre</label>
                    <input type="text" th:field ="*{nomMascota}" class="w-full border border-borderLight rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:outline-none" required>
            </div>
            <div>
                <label class="block text-sm font-semibold text-softText">Especie</label>
                <input type="text" th:field ="*{especie}" class="w-full border border-borderLight rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:outline-none" required>
            </div>
            <div>
                <label class="block text-sm font-semibold text-softText">Raza</label>
                <input type="text" th:field ="*{raza}"  class="w-full border border-borderLight rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:outline-none" min="0" required>
            </div>
            <div>
                <label class="block text-sm font-semibold text-softText">Color</label>
                <input type="text" th:field ="*{color}"  class="w-full border border-borderLight rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:outline-none" min="0" required>
            </div>
            <div>
                <label class="block text-sm font-semibold text-softText">Fecha de nacimiento</label>
                <input type="date" th:field ="*{fechaNacimiento}"   class="w-full border border-borderLight rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:outline-none" min="0" required>
            </div>
            <div>
                <label class="block text-sm font-semibold text-softText">Genero</label>
                <select th:field ="*{genero}" class="w-full border border-borderLight rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:outline-none" required>
                    <option th:value="Hembra">Hembra</option>
                    <option th:value="Macho">Macho</option>
                </select>
            </div>

            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" onclick="toggleModal('modalMascota')" class="bg-secondary text-white px-4 py-2 rounded-md hover:bg-lightSurface hover:shadow-xl hover:text-primary font-bold transition">Cancelar</button>
                <button type="submit" class="bg-secondary text-white px-4 py-2 rounded-md hover:bg-lightSurface hover:shadow-xl hover:text-primary font-bold transition">Guardar</button>
            </div>
        </form>
        <button onclick="toggleModal('modalMascota')" class="absolute top-3 right-3 text-softText hover:text-primary">
            <span class="material-icons text-lg">close</span>
        </button>
    </div>
</div>
</div>
<!-- Script para cambiar pestañas -->
<script>
    const buttons = document.querySelectorAll(".tab-btn");
    const contents = document.querySelectorAll(".tab-content");

    buttons.forEach(btn => {
        btn.addEventListener("click", () => {
            buttons.forEach(b => b.classList.remove("tab-active"));
            contents.forEach(c => c.classList.add("hidden"));

            btn.classList.add("tab-active");
            const tabId = btn.getAttribute("data-tab");
            document.querySelector(`#tab-${tabId}`).classList.remove("hidden");
        });
    });

        function toggleModal(id) {
        const modal = document.getElementById(id);
        modal.classList.toggle("hidden");
    }

        // Vincular botones del dashboard
        document.querySelectorAll("button").forEach(btn => {
        if (btn.textContent.includes("Agregar Propietario")) {
            btn.addEventListener("click", () => toggleModal('modalPropietario'));
        }
    });
        const modalMascota = document.getElementById('modalMascota');
        const inputPropietario = document.getElementById('propietarioId');

        function abrirModalMascota(idPropietario) {
        // Asigna el ID del propietario al input oculto
            inputPropietario.value = idPropietario;
        // Muestra el modal
            modalMascota.classList.remove('hidden');
    }
        function cerrarModalMascota() {
        modalMascota.classList.add('hidden');
    }

    // Opcional: cerrar modal al hacer clic fuera del contenido
    modalMascota.addEventListener('click', (e) => {
        if (e.target === modalMascota) cerrarModalMascota();
    });

    // Ya no es necesario que el listener detecte todos los botones
    // porque ahora cada botón tiene su propio onclick con el id correcto

</script>

</body>
</html>
