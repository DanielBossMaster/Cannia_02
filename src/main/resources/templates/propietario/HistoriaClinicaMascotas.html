<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Historia Clínica - Mascotas</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#170022",
                        secondary: "#290043",
                        lightBg: "#e8ebff",
                        lightSurface: "rgb(247,248,249)",
                        darkText: "#1e293b",
                        softText: "#475569",
                        borderLight: "#e2e8f0",
                    },
                },
            },
        };
    </script>
    <style> body {font-family: 'Poppins', sans-serif;} </style>
</head>
<body class="bg-lightBg text-gray-800">

<header class="bg-primary text-white flex justify-between items-center px-6 py-3 shadow-md">
    <div class="flex items-center space-x-3">
        <img src="/img/logo.png" alt="Logo" class="w-10 h-10">
        <h1 class="text-lg font-bold">Cannia</h1>
    </div>

    <a th:href="@{/propietario/index}"
       class="bg-primary hover:bg-secondary px-4 py-2  shadow text-white transition">
        <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="#ffffff"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-chevron-left-icon lucide-chevron-left">
            <path d="m15 18-6-6 6-6"/>
        </svg>
    </a>
</header>

<div class="max-w-5xl mx-auto mt-10 bg-white shadow-xl p-8">

    <h2 class="text-3xl font-bold mb-6 text-center">
        <svg
                xmlns="http://www.w3.org/2000/svg"
                width="34"
                height="34"
                viewBox="0 0 24 24"
                fill="none"
                stroke="#000000"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-file-text-icon lucide-file-text">
            <path d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"/>
            <path d="M14 2v5a1 1 0 0 0 1 1h5"/>
            <path d="M10 9H8"/>
            <path d="M16 13H8"/>
            <path d="M16 17H8"/>
        </svg>
        Historia Clínica de tus Mascotas
    </h2>

    <table class="min-w-full bg-white -lg shadow">
        <thead>
        <tr class="bg-secondary text-white text-left">
            <th class="py-3 px-4">Nombre</th>
            <th class="py-3 px-4">Especie</th>
            <th class="py-3 px-4">Raza</th>
            <th class="py-3 px-4">Género</th>
            <th class="py-3 px-4 text-center">Acciones</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="m : ${mascotas}" class="border-b hover:bg-gray-100 transition">

            <td class="py-3 px-4" th:text="${m.nomMascota}"></td>
            <td class="py-3 px-4" th:text="${m.especie}"></td>
            <td class="py-3 px-4" th:text="${m.raza}"></td>
            <td class="py-3 px-4" th:text="${m.genero}"></td>

            <td class="py-3 px-4 text-center">
                <button
                        class="bg-primary hover:bg-secondary px-4 py-2 text-white -lg shadow transition"
                        th:attr="onclick=|abrirModal(${m.id}, '${m.nomMascota}')|">
                    <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="#ffffff"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="lucide lucide-eye-icon lucide-eye">
                        <path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </button>
            </td>

        </tr>
        </tbody>
    </table>
</div>

<!-- ================= MODAL ================= -->
<div id="modalHistoria"
     class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">

    <div class="bg-white -2xl shadow-xl w-11/12 max-w-4xl p-6 relative">

        <!-- Botón cerrar -->
        <button onclick="cerrarModal()"
                class="absolute top-4 right-4 text-gray-500 hover:text-black text-2xl">
            ✕
        </button>

        <h3 id="modalTitulo" class="text-2xl font-bold mb-4"></h3>

        <!-- Contenido dinámico -->
        <div id="contenidoHistoria" class="overflow-y-auto max-h-[60vh]">
            <p class="text-center text-gray-500">Cargando historia clínica...</p>
        </div>

    </div>
</div>

<!-- ================= JS ================= -->
<script>
    function abrirModal(idMascota, nombreMascota) {
        document.getElementById('modalTitulo').innerText =
            'Historia Clínica de ' + nombreMascota;

        document.getElementById('modalHistoria').classList.remove('hidden');
        document.getElementById('modalHistoria').classList.add('flex');

        // Cargar historia clínica vía fetch
        fetch('/propietario/mascota/' + idMascota + '/historia')
            .then(res => res.text())
            .then(html => {
                document.getElementById('contenidoHistoria').innerHTML = html;
            })
            .catch(() => {
                document.getElementById('contenidoHistoria').innerHTML =
                    '<p class="text-red-500 text-center">Error al cargar la historia clínica</p>';
            });
    }

    function cerrarModal() {
        document.getElementById('modalHistoria').classList.add('hidden');
        document.getElementById('modalHistoria').classList.remove('flex');
        document.getElementById('contenidoHistoria').innerHTML = '';
    }
</script>

</body>
</html>
